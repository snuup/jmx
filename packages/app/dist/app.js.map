{"version":3,"file":"app.js","sources":["../../jmx-runtime/dist/index.js"],"sourcesContent":["function rebind(o) {\r\n    Object.entries(Object.getOwnPropertyDescriptors(Object.getPrototypeOf(o)))\r\n        .filter(([name, p]) => name != 'constructor' && p.value instanceof Function)\r\n        .forEach(([name]) => o[name] = o[name].bind(o));\r\n    return o;\r\n}\r\nfunction mount(o) { Object.assign(globalThis, o); }\r\nconst loggedmethodsex = (o, logger) => new Proxy(o, {\r\n    get(target, name, receiver) {\r\n        if (typeof target[name] === \"function\") {\r\n            return function (...args) {\r\n                logger(name, args, undefined);\r\n                let r = target[name].apply(this, args);\r\n                return r;\r\n            };\r\n        }\r\n        return Reflect.get(target, name, receiver);\r\n    },\r\n});\r\nconst loggedmethods = (o) => loggedmethodsex(o, (name, args, result) => console.log(\"%c\" + name, \"background:#585059;color:white;padding:2px;font-weight:bold\", args));\r\nconst loggedmethodscolored = (bgcolor, o) => loggedmethodsex(o, (name, args, result) => console.log(\"%c\" + name, `background:${bgcolor};color:white;padding:2px;font-weight:bold`, args));\r\n\r\nglobalThis.jmx = {\r\n    create: (tagName) => document.createElement(tagName)\r\n};\r\nlet evaluate = (expr) => expr instanceof Function ? expr() : expr;\r\nlet removeexcesschildren = (n, i) => { let c; while ((c = n.childNodes[i])) {\r\n    c.remove();\r\n} };\r\nlet iswebcomponent = (h) => h.tag.includes('-');\r\nlet isclasscomponent = (h) => h.tag?.prototype?.view;\r\nlet iselement = (h) => typeof h.tag == \"string\";\r\nlet isfragment = (h) => { return h.tag == undefined && h.cn != undefined; };\r\nlet isobject = (o) => typeof o === \"object\";\r\nlet isproperty = (name, value) => (['value', 'checked', 'disabled', 'className', 'style', 'href', 'src', 'selected', 'readOnly', 'tabIndex',].includes(name)\r\n    || value instanceof Object\r\n    || value instanceof Function);\r\nlet clean = (o) => { for (let k in o)\r\n    o[k] === undefined && delete o[k]; };\r\nlet setprops = (e, newprops = {}) => {\r\n    let oldprops = evaluate(e.h?.p) ?? {};\r\n    clean(newprops);\r\n    for (let p in oldprops) {\r\n        if (!(p in newprops)) {\r\n            if (isproperty(p, oldprops[p])) {\r\n                e[p] = null;\r\n            }\r\n            else {\r\n                e.removeAttribute(p);\r\n            }\r\n        }\r\n    }\r\n    for (let p in newprops)\r\n        isproperty(p, newprops[p]) ? e[p] = newprops[p] : e.setAttribute(p, newprops[p]);\r\n};\r\nfunction sync(p, i, h, uc) {\r\n    h = evaluate(h);\r\n    if (h === null || h === undefined || h === false || h === true)\r\n        return i;\r\n    let c = p.childNodes[i];\r\n    function synctextnode(text) {\r\n        if (c && c.nodeType == 3) {\r\n            if (c.textContent != text)\r\n                c.textContent = text;\r\n        }\r\n        else {\r\n            let tn = document.createTextNode(text);\r\n            c ? c.replaceWith(tn) : p.appendChild(tn);\r\n        }\r\n    }\r\n    if (isobject(h)) {\r\n        function syncchildren(p, h, i) {\r\n            evaluate(h.cn)?.flat().forEach(hc => i = sync(p, i, hc, uc));\r\n            return i;\r\n        }\r\n        if (isfragment(h))\r\n            return syncchildren(p, h, i);\r\n        const props = evaluate(h.p);\r\n        if (iselement(h)) {\r\n            let n;\r\n            if (c?.tagName != h.tag) {\r\n                n = window.jmx.create(h.tag);\r\n                c ? c.replaceWith(n) : p.appendChild(n);\r\n                setprops(n, props);\r\n                props?.mounted?.(n);\r\n            }\r\n            else {\r\n                n = c;\r\n                if (props?.const && n.hasAttribute(\"const\")) {\r\n                    return i + 1;\r\n                }\r\n                setprops(n, props);\r\n                if (props?.update?.(c, uc))\r\n                    return i + 1;\r\n            }\r\n            n.h = h;\r\n            if (!uc.patchElementOnly && !iswebcomponent(h)) {\r\n                const j = syncchildren(n, h, 0);\r\n                removeexcesschildren(n, j);\r\n            }\r\n            return i + 1;\r\n        }\r\n        switch (typeof h.tag) {\r\n            case 'function':\r\n                let isupdate = c?.h?.tag == h.tag;\r\n                let state;\r\n                let ci;\r\n                if (isclasscomponent(h)) {\r\n                    h.i = ci = c?.h?.i ?? rebind(new h.tag(props));\r\n                    ci.props = props;\r\n                    if (isupdate && ci.update(uc))\r\n                        return i + 1;\r\n                }\r\n                else {\r\n                    state = p.childNodes[i]?.state;\r\n                    if (uc.functionnode?.h == h) {\r\n                        return sync(p, i, c.hr, uc);\r\n                    }\r\n                    if (state?.uc) {\r\n                        state.updateglobal();\r\n                        return i + 1;\r\n                    }\r\n                }\r\n                let hr = ci?.view() ?? h.tag.bind(state ??= (h.tag.state ?? new FunCompState()))(props, evaluate(h.cn));\r\n                if (hr === undefined || hr == null)\r\n                    return i;\r\n                let j = sync(p, i, hr, uc);\r\n                let cn = p.childNodes[i];\r\n                cn.h = h;\r\n                cn.hr = hr;\r\n                Object.assign(cn, { h, state });\r\n                if (state)\r\n                    state.element ??= cn;\r\n                if (ci)\r\n                    ci.element = cn;\r\n                if (!isupdate)\r\n                    ci?.mounted();\r\n                return j;\r\n            case 'object':\r\n                return sync(p, i, h.tag, uc);\r\n        }\r\n    }\r\n    synctextnode(h);\r\n    return i + 1;\r\n}\r\nfunction patch(e, h, uc = {}) {\r\n    if (!e)\r\n        return;\r\n    if (uc.replace)\r\n        e.replaceChildren();\r\n    const p = e.parentElement;\r\n    const i = [].indexOf.call(p.childNodes, e);\r\n    sync(p, i, h, uc);\r\n}\r\nlet isselector = (x) => typeof x === \"string\" || x instanceof Node;\r\nfunction updateview(...us) {\r\n    {\r\n        if (!us.length)\r\n            us = [document.body];\r\n        let uc;\r\n        let u0 = us[0];\r\n        if (!isselector(u0)) {\r\n            uc = u0;\r\n            us = us.slice(1);\r\n        }\r\n        return new Promise((resolve) => {\r\n            requestAnimationFrame(() => {\r\n                us\r\n                    .flatMap(x => (typeof x == 'string') ? [...(uc?.root ?? document).querySelectorAll(x)] : [x])\r\n                    .forEach(e => {\r\n                    if (!e?.h)\r\n                        throw 'jmx: no h exists on the node';\r\n                    patch(e, e.h, uc);\r\n                });\r\n                resolve();\r\n            });\r\n        });\r\n    }\r\n}\r\nfunction jsx() { throw 'jmx plugin not configured'; }\r\nfunction jsxf() { throw 'jmx plugin not configured'; }\r\nmount({ updateview });\r\nclass FunCompState {\r\n    element;\r\n    uc;\r\n    update(...us) {\r\n        if (!us.length) {\r\n            updateview({ functionnode: this.element }, this.element);\r\n            return;\r\n        }\r\n        let uc;\r\n        let usx;\r\n        let u0 = us[0];\r\n        if (!isselector(u0)) {\r\n            uc = u0;\r\n            const [_, ...ss] = us;\r\n            usx = ss;\r\n        }\r\n        else {\r\n            uc = {};\r\n            usx = us;\r\n        }\r\n        uc.root = this.element;\r\n        uc.functionnode = this.element;\r\n        if (!usx.length)\r\n            usx = [this.element];\r\n        updateview(uc, ...usx);\r\n    }\r\n    updateglobal() {\r\n        if (this.uc == \"*\")\r\n            this.uc = this.element;\r\n        this.update(...this.uc);\r\n    }\r\n}\r\n\r\nconst When = ({ cond }, cn) => cond ? { cn } : void 0;\r\nclass JMXComp {\r\n    props;\r\n    element;\r\n    constructor(props) {\r\n        this.props = props;\r\n        this.init();\r\n    }\r\n    init() { }\r\n    mounted() { }\r\n    update(uc) { }\r\n    updateview() { updateview(this.element); }\r\n}\r\nfunction cc(...namesOrObjects) {\r\n    return namesOrObjects.flatMap(n => (n.trim ? n : Object.keys(n).filter(k => n[k]))).join(' ');\r\n}\r\n\r\nexport { JMXComp, When, cc, jsx, jsxf, loggedmethods, loggedmethodscolored, loggedmethodsex, mount, patch, rebind, updateview };\r\n//# sourceMappingURL=index.js.map\r\n"],"names":["rebind","o","name","p","mount","tagName","evaluate","expr","removeexcesschildren","n","i","c","iswebcomponent","h","isclasscomponent","iselement","isfragment","isobject","isproperty","value","clean","k","setprops","newprops","oldprops","sync","uc","synctextnode","text","tn","syncchildren","hc","props","j","isupdate","state","ci","hr","FunCompState","cn","patch","isselector","x","updateview","us","u0","resolve","e","usx","_","ss"],"mappings":"AAAA,SAASA,EAAOC,EAAG,CACf,cAAO,QAAQ,OAAO,0BAA0B,OAAO,eAAeA,CAAC,CAAC,CAAC,EACpE,OAAO,CAAC,CAACC,EAAMC,CAAC,IAAMD,GAAQ,eAAiBC,EAAE,iBAAiB,QAAQ,EAC1E,QAAQ,CAAC,CAACD,CAAI,IAAMD,EAAEC,CAAI,EAAID,EAAEC,CAAI,EAAE,KAAKD,CAAC,CAAC,EAC3CA,CACX,CACA,SAASG,EAAMH,EAAG,CAAE,OAAO,OAAO,WAAYA,CAAC,CAAI,CAgBnD,WAAW,IAAM,CACb,OAASI,GAAY,SAAS,cAAcA,CAAO,CACvD,EACA,IAAIC,EAAYC,GAASA,aAAgB,SAAWA,EAAM,EAAGA,EACzDC,EAAuB,CAACC,EAAGC,IAAM,CAAE,IAAIC,EAAG,KAAQA,EAAIF,EAAE,WAAWC,CAAC,GACpEC,EAAE,OAAM,GAERC,EAAkBC,GAAMA,EAAE,IAAI,SAAS,GAAG,EAC1CC,EAAoBD,GAAMA,EAAE,KAAK,WAAW,KAC5CE,EAAaF,GAAM,OAAOA,EAAE,KAAO,SACnCG,EAAcH,GAAeA,EAAE,KAAO,MAAaA,EAAE,IAAM,KAC3DI,EAAYhB,GAAM,OAAOA,GAAM,SAC/BiB,EAAa,CAAChB,EAAMiB,IAAW,CAAC,QAAS,UAAW,WAAY,YAAa,QAAS,OAAQ,MAAO,WAAY,WAAY,UAAY,EAAC,SAASjB,CAAI,GACpJiB,aAAiB,QACjBA,aAAiB,SACpBC,EAASnB,GAAM,CAAE,QAASoB,KAAKpB,EAC/BA,EAAEoB,CAAC,IAAM,QAAa,OAAOpB,EAAEoB,CAAC,GAChCC,EAAW,CAAC,EAAGC,EAAW,KAAO,CACjC,IAAIC,EAAWlB,EAAS,EAAE,GAAG,CAAC,GAAK,GACnCc,EAAMG,CAAQ,EACd,QAASpB,KAAKqB,EACJrB,KAAKoB,IACHL,EAAWf,EAAGqB,EAASrB,CAAC,CAAC,EACzB,EAAEA,CAAC,EAAI,KAGP,EAAE,gBAAgBA,CAAC,GAI/B,QAASA,KAAKoB,EACVL,EAAWf,EAAGoB,EAASpB,CAAC,CAAC,EAAI,EAAEA,CAAC,EAAIoB,EAASpB,CAAC,EAAI,EAAE,aAAaA,EAAGoB,EAASpB,CAAC,CAAC,CACvF,EACA,SAASsB,EAAKtB,EAAGO,EAAGG,EAAGa,EAAI,CAEvB,GADAb,EAAIP,EAASO,CAAC,EACVA,GAAM,MAA2BA,IAAM,IAASA,IAAM,GACtD,OAAOH,EACX,IAAIC,EAAIR,EAAE,WAAWO,CAAC,EACtB,SAASiB,EAAaC,EAAM,CACxB,GAAIjB,GAAKA,EAAE,UAAY,EACfA,EAAE,aAAeiB,IACjBjB,EAAE,YAAciB,OAEnB,CACD,IAAIC,EAAK,SAAS,eAAeD,CAAI,EACrCjB,EAAIA,EAAE,YAAYkB,CAAE,EAAI1B,EAAE,YAAY0B,CAAE,CAC3C,CACJ,CACD,GAAIZ,EAASJ,CAAC,EAAG,CACb,IAASiB,EAAT,SAAsB3B,EAAGU,EAAGH,EAAG,CAC3B,OAAAJ,EAASO,EAAE,EAAE,GAAG,KAAI,EAAG,QAAQkB,GAAMrB,EAAIe,EAAKtB,EAAGO,EAAGqB,EAAIL,CAAE,CAAC,EACpDhB,CACV,EAHQ,IAAAoB,IAIT,GAAId,EAAWH,CAAC,EACZ,OAAOiB,EAAa3B,EAAGU,EAAGH,CAAC,EAC/B,MAAMsB,EAAQ1B,EAASO,EAAE,CAAC,EAC1B,GAAIE,EAAUF,CAAC,EAAG,CACd,IAAIJ,EACJ,GAAIE,GAAG,SAAWE,EAAE,IAChBJ,EAAI,OAAO,IAAI,OAAOI,EAAE,GAAG,EAC3BF,EAAIA,EAAE,YAAYF,CAAC,EAAIN,EAAE,YAAYM,CAAC,EACtCa,EAASb,EAAGuB,CAAK,EACjBA,GAAO,UAAUvB,CAAC,UAGlBA,EAAIE,EACAqB,GAAO,OAASvB,EAAE,aAAa,OAAO,IAG1Ca,EAASb,EAAGuB,CAAK,EACbA,GAAO,SAASrB,EAAGe,CAAE,GACrB,OAAOhB,EAAI,EAGnB,GADAD,EAAE,EAAII,EACF,CAACa,EAAG,kBAAoB,CAACd,EAAeC,CAAC,EAAG,CAC5C,MAAMoB,EAAIH,EAAarB,EAAGI,EAAG,CAAC,EAC9BL,EAAqBC,EAAGwB,CAAC,CAC5B,CACD,OAAOvB,EAAI,CACd,CACD,OAAQ,OAAOG,EAAE,IAAG,CAChB,IAAK,WACD,IAAIqB,EAAWvB,GAAG,GAAG,KAAOE,EAAE,IAC1BsB,EACAC,EACJ,GAAItB,EAAiBD,CAAC,GAGlB,GAFAA,EAAE,EAAIuB,EAAKzB,GAAG,GAAG,GAAKX,EAAO,IAAIa,EAAE,IAAImB,CAAK,CAAC,EAC7CI,EAAG,MAAQJ,EACPE,GAAYE,EAAG,OAAOV,CAAE,EACxB,OAAOhB,EAAI,MAEd,CAED,GADAyB,EAAQhC,EAAE,WAAWO,CAAC,GAAG,MACrBgB,EAAG,cAAc,GAAKb,EACtB,OAAOY,EAAKtB,EAAGO,EAAGC,EAAE,GAAIe,CAAE,EAE9B,GAAIS,GAAO,GACP,OAAAA,EAAM,aAAY,EACXzB,EAAI,CAElB,CACD,IAAI2B,EAAKD,GAAI,KAAM,GAAIvB,EAAE,IAAI,KAAKsB,IAAWtB,EAAE,IAAI,OAAS,IAAIyB,CAAe,EAAEN,EAAO1B,EAASO,EAAE,EAAE,CAAC,EACtG,GAAIwB,IAAO,QAAaA,GAAM,KAC1B,OAAO3B,EACX,IAAIuB,EAAIR,EAAKtB,EAAGO,EAAG2B,EAAIX,CAAE,EACrBa,EAAKpC,EAAE,WAAWO,CAAC,EACvB,OAAA6B,EAAG,EAAI1B,EACP0B,EAAG,GAAKF,EACR,OAAO,OAAOE,EAAI,CAAE,EAAA1B,EAAG,MAAAsB,CAAO,CAAA,EAC1BA,IACAA,EAAM,UAAYI,GAClBH,IACAA,EAAG,QAAUG,GACZL,GACDE,GAAI,QAAO,EACRH,EACX,IAAK,SACD,OAAOR,EAAKtB,EAAGO,EAAGG,EAAE,IAAKa,CAAE,CAClC,CACJ,CACD,OAAAC,EAAad,CAAC,EACPH,EAAI,CACf,CACA,SAAS8B,EAAM,EAAG3B,EAAGa,EAAK,CAAA,EAAI,CAC1B,GAAI,CAAC,EACD,OACAA,EAAG,SACH,EAAE,gBAAe,EACrB,MAAMvB,EAAI,EAAE,cACN,EAAI,CAAA,EAAG,QAAQ,KAAKA,EAAE,WAAY,CAAC,EACzCsB,EAAKtB,EAAG,EAAGU,EAAGa,CAAE,CACpB,CACA,IAAIe,EAAcC,GAAM,OAAOA,GAAM,UAAYA,aAAa,KAC9D,SAASC,KAAcC,EAAI,CACvB,CACSA,EAAG,SACJA,EAAK,CAAC,SAAS,IAAI,GACvB,IAAIlB,EACAmB,EAAKD,EAAG,CAAC,EACb,OAAKH,EAAWI,CAAE,IACdnB,EAAKmB,EACLD,EAAKA,EAAG,MAAM,CAAC,GAEZ,IAAI,QAASE,GAAY,CAC5B,sBAAsB,IAAM,CACxBF,EACK,QAAQF,GAAM,OAAOA,GAAK,SAAY,CAAC,IAAIhB,GAAI,MAAQ,UAAU,iBAAiBgB,CAAC,CAAC,EAAI,CAACA,CAAC,CAAC,EAC3F,QAAQK,GAAK,CACd,GAAI,CAACA,GAAG,EACJ,KAAM,+BACVP,EAAMO,EAAGA,EAAE,EAAGrB,CAAE,CACpC,CAAiB,EACDoB,GAChB,CAAa,CACb,CAAS,CACJ,CACL,CAGA1C,EAAM,CAAE,WAAAuC,CAAU,CAAE,EACpB,MAAML,CAAa,CACf,QACA,GACA,UAAUM,EAAI,CACV,GAAI,CAACA,EAAG,OAAQ,CACZD,EAAW,CAAE,aAAc,KAAK,OAAO,EAAI,KAAK,OAAO,EACvD,MACH,CACD,IAAIjB,EACAsB,EACAH,EAAKD,EAAG,CAAC,EACb,GAAKH,EAAWI,CAAE,EAMdnB,EAAK,CAAA,EACLsB,EAAMJ,MAPW,CACjBlB,EAAKmB,EACL,KAAM,CAACI,EAAG,GAAGC,CAAE,EAAIN,EACnBI,EAAME,CACT,CAKDxB,EAAG,KAAO,KAAK,QACfA,EAAG,aAAe,KAAK,QAClBsB,EAAI,SACLA,EAAM,CAAC,KAAK,OAAO,GACvBL,EAAWjB,EAAI,GAAGsB,CAAG,CACxB,CACD,cAAe,CACP,KAAK,IAAM,MACX,KAAK,GAAK,KAAK,SACnB,KAAK,OAAO,GAAG,KAAK,EAAE,CACzB,CACL"}