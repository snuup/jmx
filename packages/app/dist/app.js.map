{"version":3,"file":"app.js","sources":["../../jmx-runtime/dist/base.js","../../jmx-runtime/dist/jmx.js"],"sourcesContent":["export function rebind(o) {\n    Object.entries(Object.getOwnPropertyDescriptors(Object.getPrototypeOf(o)))\n        .filter(([name, p]) => name != 'constructor' && p.value instanceof Function)\n        .forEach(([name]) => o[name] = o[name].bind(o));\n    return o;\n}\nexport function mount(o) { Object.assign(globalThis, o); }\nexport const loggedmethodsex = (o, logger) => new Proxy(o, {\n    get(target, name, receiver) {\n        if (typeof target[name] === \"function\") {\n            return function (...args) {\n                logger(name, args, undefined);\n                let r = target[name].apply(this, args);\n                return r;\n            };\n        }\n        return Reflect.get(target, name, receiver);\n    },\n});\nexport const loggedmethods = (o) => loggedmethodsex(o, (name, args, result) => console.log(\"%c\" + name, \"background:#585059;color:white;padding:2px;font-weight:bold\", args));\nexport const loggedmethodscolored = (bgcolor, o) => loggedmethodsex(o, (name, args, result) => console.log(\"%c\" + name, `background:${bgcolor};color:white;padding:2px;font-weight:bold`, args));\n//# sourceMappingURL=base.js.map","import { rebind } from './base';\nlet evaluate = (expr) => (expr instanceof Function ? expr() : expr);\nlet removeexcesschildren = (n, i) => {\n    let c;\n    while ((c = n.childNodes[i])) {\n        c.remove();\n    }\n};\nlet iswebcomponent = (h) => h.tag.includes('-');\nlet isclasscomponent = (h) => h.tag?.prototype?.view;\nlet iselement = (h) => typeof h.tag == 'string';\nlet isfragment = (h) => {\n    return h.tag == undefined && h.cn != undefined;\n};\nlet isobject = (o) => typeof o === 'object';\nlet isproperty = (name, value) => ['value', 'checked', 'disabled', 'className', 'style', 'href', 'src', 'selected', 'readOnly', 'tabIndex'].includes(name) ||\n    value instanceof Object ||\n    value instanceof Function;\nlet setprops = (e, newprops = {}) => {\n    let oldprops = evaluate(e.h?.p) ?? {};\n    for (let p in oldprops)\n        !(p in newprops) && isproperty(p, oldprops[p]) ? (e[p] = null) : e.removeAttribute(p);\n    for (let p in newprops)\n        isproperty(p, newprops[p]) ? (e[p] = newprops[p]) : e.setAttribute(p, newprops[p]);\n};\nfunction sync(p, i, h, uc) {\n    h = evaluate(h);\n    if (h === null || h === undefined)\n        return i;\n    let c = p.childNodes[i];\n    function synctextnode(text) {\n        if (c && c.nodeType == 3) {\n            if (c.textContent != text)\n                c.textContent = text;\n        }\n        else {\n            let tn = document.createTextNode(text);\n            c ? c.replaceWith(tn) : p.appendChild(tn);\n        }\n    }\n    if (isobject(h)) {\n        function syncchildren(p, h, i) {\n            evaluate(h.cn)\n                ?.flat()\n                .forEach(hc => (i = sync(p, i, hc, uc)));\n            return i;\n        }\n        if (isfragment(h))\n            return syncchildren(p, h, i);\n        const props = evaluate(h.p);\n        if (iselement(h)) {\n            let n;\n            if (c?.tagName != h.tag) {\n                n = document.createElement(h.tag);\n                c ? c.replaceWith(n) : p.appendChild(n);\n                setprops(n, props);\n                props?.mounted?.(n);\n            }\n            else {\n                n = c;\n                setprops(n, props);\n                if (props?.update?.(c, uc))\n                    return i + 1;\n            }\n            n.h = h;\n            if (!uc.patchElementOnly && !iswebcomponent(h)) {\n                const j = syncchildren(n, h, 0);\n                removeexcesschildren(n, j);\n            }\n            return i + 1;\n        }\n        switch (typeof h.tag) {\n            case 'function':\n                let isupdate = c?.h?.tag == h.tag;\n                let ci;\n                if (isclasscomponent(h)) {\n                    h.i = ci = c?.h?.i ?? rebind(new h.tag(props));\n                    ci.props = props;\n                    if (isupdate && ci.update(uc))\n                        return i + 1;\n                }\n                let hr = ci?.view() ?? h.tag(props, evaluate(h.cn));\n                if (hr === undefined || hr == null)\n                    return i;\n                let j = sync(p, i, hr, uc);\n                let cn = p.childNodes[i];\n                cn.h = h;\n                if (ci)\n                    ci.element = cn;\n                if (!isupdate)\n                    ci?.mounted();\n                return j;\n            case 'object':\n                return sync(p, i, h.tag, uc);\n        }\n    }\n    synctextnode(h);\n    return i + 1;\n}\nexport function patch(e, h, uc = {}) {\n    if (!e)\n        return;\n    if (uc.replace)\n        e.replaceChildren();\n    const p = e.parentElement;\n    const i = [].indexOf.call(p.childNodes, e);\n    requestAnimationFrame(() => sync(p, i, h, uc));\n}\nexport function updateview(...ucOrSelectors) {\n    {\n        let uc;\n        ucOrSelectors\n            .flatMap(x => typeof x == 'string' ? [...document.querySelectorAll(x)] : x instanceof Node ? [x] : ((uc = x), []))\n            .forEach(e => {\n            if (!e?.h)\n                throw 'jmx: no h exists on the node';\n            patch(e, e.h, uc);\n        });\n    }\n}\nexport function jsx() {\n    throw 'jmx plugin not configured';\n}\nexport function jsxf() {\n    throw 'jmx plugin not configured';\n}\n//# sourceMappingURL=jmx.js.map"],"names":["rebind","o","name","p","mount","evaluate","expr","removeexcesschildren","n","i","c","iswebcomponent","h","isclasscomponent","iselement","isfragment","isobject","isproperty","value","setprops","newprops","oldprops","sync","uc","synctextnode","text","tn","syncchildren","hc","props","j","isupdate","ci","hr","cn","patch","updateview","ucOrSelectors","x","e"],"mappings":"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"}